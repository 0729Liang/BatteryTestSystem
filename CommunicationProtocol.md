
# 电池测试系统说明文档


## 1.控制端 *发送* 命令格式

 帧头 |  总字节数   |命令|设备号|通道号|校验和|帧尾 
 ----|-----------|----|-----|-----|----|----
 7BH | 0x00 0x60   | 0x71|0x01 | 0x01 |0x00|7DH 


7B 0000 8F 01 0001 007D
[注:] 设备号和通道号各一个字节

控制命令：7B0000+命令字+设备号+通道位标志（2字节）+00+7D

```
    启动，暂停，停止，恢复，清错误：通道4位
    其余 通道位 1 位
```

控制命令：7B0000+命令字+设备号+通道位标志（2字节）+00+7D
 

## 2.命令详情

1、启动命令	0x8F

2、暂停命令	0x65

3、恢复命令	0x6A

4、查询数据	0x71：7B 0000 71 01 00 00 00 01 007D

5、清错误    0x6c

6、启动并机  0x44

7、停止      0x60

8、查询通道状态    0x80









举例： 

    设备0x01 通道0x01 发送启动测试0x8F:  7B 00 08 8F 01 01 00 7D
    设备0x01 通道0x02 发送暂停测试0x8F:  7B 00 08 65 01 02 00 7D


gungunngun:liu9702140516

server:	192.168.100.8

client:	192.168.100.152


## 3.控制端 *接收* 命令详情

移动端  接收实时数据紧挨着来的（浮点值说明见最后）

说明：多字节的是高字节在前，低字节在后的顺序
```
浮点值转换规则
2个字节浮点值解析：先转换成浮点数,然后除以100
4个字节浮点值解析：先转换成浮点数,然后除以1000
8个字节浮点值解析：先转换成浮点数,然后除以1000
```
如： 

设备0x02 通道 0x01 发来的测试数据：
7B000071**02**05060708017B01**01**0C1400000107000000D4000000AE000000DB000002B1C3A0C38F001A00510003003C000000510000029F0000028D0000022900000000000001C5000000000000000E010B0000011D000000BC000000000000067D007D00  ——                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                》 00 00 |00 00| 00|00|  06|7D|00|   7D00

总帧头| 2字节 | 命令 | 设备号* |    4字节   | 此条数据包含的通道数 | 通道帧头 | isSave(0:false,1：true)| 通道号* | 错误代码 |  模式  | 4字节电压浮点值* | 电流浮点值  |  功率浮点值  | 总安时浮点值 | 总瓦时浮点值 |    2个字节先转化成浮点值然后减去偏移量 得到温度1（中位机）*   | 2个字节先转化成浮点值然后减去偏移量 得到温度2（中位机） |  2个字节循环次数整数 |    2个字节内循环次数1整数     |   2个字节内循环次数2整数  |  2个字节内循环次数3整数 |  4个字节充电安时浮点值* | 4个字节放电安时浮点值  | 4个字节充电瓦时浮点值 |  4个字节放电瓦时浮点值  |   8个字节 步测试时间浮点值*  |      8个字节 总测试时间浮点值  |    2个字节步号整数*   |  4个字节内阻浮点值  |  4个字节容量浮点值 |   2个字节并机标识整数   | 2个字节CAN变量整数 |  1个字节数采个数 | 1个字节数据变化标识，00-有变化，ff-数据无变化 | 1个字节校验 0 |1个字节跨过数据封装尾 |帧尾                                                                                                                                         
-----|------|-----|:-----:|-----------|:-----------------:|---------|:-------------------:|--------|---------|------|----------------|-----------|------------|-----------|------------|:---------------------------------------------------:|:----------------------------------------------:|:-----------------:|:------------------------:|:---------------------:|:-------------------:|:-------------------:|:------------------:|:------------------:|:-------------------:|:-----------------------:|:--------------------------:|:-----------------:|:----------------:|:---------------:|:-------------------:|:---------------:|:-------------:|:--------------------------------------:|:-----------:|:----------------:|----
  7B | 00 00 |  71  |   02  | 05 06 07 08 |           01        |     7B    |          01            |    01   |     0C   |   14  |   00 00 01 07   | 00 00 00 D4 | 00 00 00 AE | 00 00 00 DB | 00 00 02 B1 |             C3                     A0                      |             C3                   8F                  |       00    1A      |          00    51           |         00  03           |      00      3C        |        00 00 00 51     |      00 00 02 9F     |     00  00   02  8D  |      00 00 02 29       | 00 00 00 00     00 00 01 C5 |  00 00 00 00      00 00 00 0E |          01 0B      |    00 00 01 1D      |     00 00 00 BC   |            00 00      |       00  00       |        00       |                      00                    |       06      |        7D          |00 7D 00 -》00 00 00 00 00 00 06 7D 00              7D 00


    注释:
    --------:注: 有几个7B就有几个7D
    --------:共计长度99字节，索引范围0-98，
    --------:前12位（索引0-11）不重复，帧尾（索引99）不重复
    --------:一条通道数据占86字节，最大16通道
    --------:最短包长度（只有1通道数据）：13*2+86*2=198位     即99字节
    --------:最长包长度（含16通道数据）：13*2+86*2*16=2778位  即1389字节
    -------------------------------------------------------------------------------------------
    详细说明
    前12位
    1字节总帧头 7B   ->0
    2字节长度       ->1-2
    1字节命令（0x71） ->3
    
    1个字节表示设备号*  ->4
    4个字节不用管 ->5-8
    1个字节表示此条数据包含的通道数（最大16位），后边跟着通道信息    ->9
    
    1个字节通道帧头 0x7B   ->10
    1个字节IsSave 1表示true 0表示false     ->11

    ----------------------------------------------------
    后 88 位 88*16+11
    1个字节通道号*    ->12
    1个字节状态字（错误代码）   ->13
    1个字节模式      ->14
    
    4个字节电压浮点值*  ->15-18
    4个字节电流浮点值   ->19-22
    4个字节功率浮点值   ->23-26
    4个字节总安时浮点值  ->27-30
    4个字节总瓦时浮点值  ->31-34
    
    2个字节先转化成浮点值然后减去偏移量 得到温度1（中位机）*  ->35-36
    2个字节先转化成浮点值然后减去偏移量 得到温度2（中位机）   ->37-38
    2个字节循环次数整数  ->39-40
    2个字节内循环次数1整数    ->41-42
    2个字节内循环次数2整数    ->43-44
    2个字节内循环次数3整数    ->45-46
    
    4个字节充电安时浮点值*    ->47-50
    4个字节放电安时浮点值     ->51-54
    4个字节充电瓦时浮点值     ->55-58
    4个字节放电瓦时浮点值     ->59-62
    
    8个字节步测试时间浮点值*   ->63-70
    8个字节总测试时间浮点值    ->71-78
    
    2个字节步号整数*    ->79-80
    4个字节内阻浮点值   ->81-84
    4个字节容量浮点值   ->85-88
    2个字节并机标识整数 ->89-90
    2个字节CAN变量整数  ->91-92
    1个字节数采个数     ->93
    
    1个字节数据变化标识，00-有变化，ff-数据无变化* ->94
    1个字节校验 0    ->95
    1个字节跨过数据封装尾 ->96
    1字节通道帧尾 0x7D    ->97
    总帧尾 0x7D    ->98
   
    
     
    












 